{"version":3,"sources":["../src/chrome/consoleHelper.ts"],"names":[],"mappings":"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","file":"consoleHelper.js","sourcesContent":["/*---------------------------------------------------------\n * Copyright (C) Microsoft Corporation. All rights reserved.\n *--------------------------------------------------------*/\n\nimport { Protocol as Crdp } from 'devtools-protocol';\nimport * as variables from './variables';\n\nexport function formatExceptionDetails(e: Crdp.Runtime.ExceptionDetails): string {\n    if (!e.exception) {\n        return `${e.text || 'Uncaught Error'}\\n${stackTraceToString(e.stackTrace)}`;\n    }\n\n    return (e.exception.className && e.exception.className.endsWith('Error') && e.exception.description) ||\n        (`Error: ${variables.getRemoteObjectPreview(e.exception)}\\n${stackTraceToString(e.stackTrace)}`);\n}\n\nexport function formatConsoleArguments(m: Crdp.Runtime.ConsoleAPICalledEvent): { args: Crdp.Runtime.RemoteObject[], isError: boolean } {\n    let args: Crdp.Runtime.RemoteObject[];\n    switch (m.type) {\n        case 'log':\n        case 'debug':\n        case 'info':\n        case 'error':\n        case 'warning':\n        case 'dir':\n        case 'timeEnd':\n        case 'count':\n            args = resolveParams(m);\n            break;\n        case 'assert':\n            const formattedParams = m.args.length ?\n                // 'assert' doesn't support format specifiers\n                resolveParams(m, /*skipFormatSpecifiers=*/true) :\n                [];\n\n            const assertMsg = (formattedParams[0] && formattedParams[0].type === 'string') ?\n                formattedParams.shift().value :\n                '';\n            let outputText = `Assertion failed: ${assertMsg}\\n` + stackTraceToString(m.stackTrace);\n\n            args = [{ type: 'string', value: outputText }, ...formattedParams];\n            break;\n        case 'startGroup':\n        case 'startGroupCollapsed':\n            let startMsg = '‹Start group›';\n            const formattedGroupParams = resolveParams(m);\n            if (formattedGroupParams.length && formattedGroupParams[0].type === 'string') {\n                startMsg += ': ' + formattedGroupParams.shift().value;\n            }\n\n            args = [{ type: 'string', value: startMsg}, ...formattedGroupParams];\n            break;\n        case 'endGroup':\n            args = [{ type: 'string', value: '‹End group›' }];\n            break;\n        case 'trace':\n            args = [{ type: 'string', value: 'console.trace()\\n' + stackTraceToString(m.stackTrace) }];\n            break;\n        default:\n            // Some types we have to ignore\n            return null;\n    }\n\n    const isError = m.type === 'assert' || m.type === 'error';\n    return { args, isError };\n}\n\n/**\n * Collapse non-object arguments, and apply format specifiers (%s, %d, etc). Return a reduced a formatted list of RemoteObjects.\n */\nfunction resolveParams(m: Crdp.Runtime.ConsoleAPICalledEvent, skipFormatSpecifiers?: boolean): Crdp.Runtime.RemoteObject[] {\n    if (!m.args.length || m.args[0].objectId) {\n        // If the first arg is not text, nothing is going to happen here\n        return m.args;\n    }\n\n    // Find all %s, %i, etc in the first argument, which is always the main text. Strip %\n    let formatSpecifiers: string[];\n    const firstTextArg = m.args.shift();\n\n    // currentCollapsedStringArg is the accumulated text\n    let currentCollapsedStringArg = variables.getRemoteObjectPreview(firstTextArg, /*stringify=*/false) + '';\n    if (firstTextArg.type === 'string' && !skipFormatSpecifiers) {\n        formatSpecifiers = (currentCollapsedStringArg.match(/\\%[sidfoOc]/g) || [])\n            .map(spec => spec[1]);\n    } else {\n        formatSpecifiers = [];\n    }\n\n    const processedArgs: Crdp.Runtime.RemoteObject[] = [];\n    const pushStringArg = (strArg: string) => {\n        if (strArg) {\n            processedArgs.push({ type: 'string', value: strArg });\n        }\n    };\n\n    // Collapse all text parameters, formatting properly if there's a format specifier\n    for (let argIdx = 0; argIdx < m.args.length; argIdx++) {\n        const arg = m.args[argIdx];\n\n        const formatSpec = formatSpecifiers.shift();\n        const formatted = formatArg(formatSpec, arg);\n\n        if (typeof formatted === 'string') {\n            if (formatSpec) {\n                // If this param had a format specifier, search and replace it with the formatted param.\n                currentCollapsedStringArg = currentCollapsedStringArg.replace('%' + formatSpec, formatted);\n            } else {\n                currentCollapsedStringArg += (currentCollapsedStringArg ? ' ' + formatted : formatted);\n            }\n        } else if (formatSpec) {\n            // `formatted` is an object - split currentCollapsedStringArg around the current formatSpec and add the object\n            const curSpecIdx = currentCollapsedStringArg.indexOf('%' + formatSpec);\n            const processedPart = currentCollapsedStringArg.slice(0, curSpecIdx);\n            pushStringArg(processedPart);\n            currentCollapsedStringArg = currentCollapsedStringArg.slice(curSpecIdx + 2);\n            processedArgs.push(formatted);\n        } else {\n            pushStringArg(currentCollapsedStringArg);\n            currentCollapsedStringArg = '';\n            processedArgs.push(formatted);\n        }\n    }\n\n    pushStringArg(currentCollapsedStringArg);\n\n    return processedArgs;\n}\n\nfunction formatArg(formatSpec: string, arg: Crdp.Runtime.RemoteObject): string | Crdp.Runtime.RemoteObject {\n    const paramValue = String(typeof arg.value !== 'undefined' ? arg.value : arg.description);\n\n    if (formatSpec === 's') {\n        return paramValue;\n    } else if (['i', 'd'].indexOf(formatSpec) >= 0) {\n        return Math.floor(+paramValue) + '';\n    } else if (formatSpec === 'f') {\n        return +paramValue + '';\n    } else if (formatSpec === 'c') {\n        // Remove %c - Applies CSS color rules\n        // Could use terminal color codes in the future\n        return '';\n    } else if (formatSpec === 'O') {\n        if (arg.objectId) {\n            return arg;\n        } else {\n            return paramValue;\n        }\n    } else {\n        // No formatSpec, or unsupported formatSpec:\n        // %o - expandable DOM element\n        if (arg.objectId) {\n            return arg;\n        } else {\n            return paramValue;\n        }\n    }\n}\n\nfunction stackTraceToString(stackTrace: Crdp.Runtime.StackTrace): string {\n    if (!stackTrace) {\n        return '';\n    }\n\n    return stackTrace.callFrames\n        .map(frame => {\n            const fnName = frame.functionName || (frame.url ? '(anonymous)' : '(eval)');\n            const fileName = frame.url ? frame.url : 'eval';\n            return `    at ${fnName} (${fileName}:${frame.lineNumber + 1}:${frame.columnNumber})`;\n        })\n        .join('\\n');\n}\n"],"sourceRoot":"../.."}