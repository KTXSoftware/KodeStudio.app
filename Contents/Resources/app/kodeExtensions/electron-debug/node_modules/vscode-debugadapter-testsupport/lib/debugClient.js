/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/
"use strict";
var __extends = (this && this.__extends) || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
};
var fs = require('fs');
var constants = require('constants');
var cp = require('child_process');
var assert = require('assert');
var net = require('net');
var protocolClient_1 = require('./protocolClient');
var DebugClient = (function (_super) {
    __extends(DebugClient, _super);
    /**
     * Creates a DebugClient object that provides a promise-based API to write
     * debug adapter tests.
     * A simple mocha example for setting and hitting a breakpoint in line 15 of a program 'test.js' looks like this:
     *
     * var dc;
     * setup( () => {
     *     dc = new DebugClient('node', './out/node/nodeDebug.js', 'node');
     *     return dc.start();
     * });
     * teardown( () => dc.stop() );
     *
     * test('should stop on a breakpoint', () => {
     *     return dc.hitBreakpoint({ program: 'test.js' }, 'test.js', 15);
     * });
     */
    function DebugClient(runtime, executable, debugType) {
        _super.call(this);
        this.defaultTimeout = 5000;
        this._runtime = runtime;
        this._executable = executable;
        this._enableStderr = false;
        this._debugType = debugType;
        this._supportsConfigurationDoneRequest = false;
        if (DebugClient.CASE_INSENSITIVE_FILESYSTEM === undefined) {
            try {
                fs.accessSync(process.execPath.toLowerCase(), constants.F_OK);
                fs.accessSync(process.execPath.toUpperCase(), constants.F_OK);
                DebugClient.CASE_INSENSITIVE_FILESYSTEM = true;
            }
            catch (err) {
                DebugClient.CASE_INSENSITIVE_FILESYSTEM = false;
            }
        }
    }
    // ---- life cycle --------------------------------------------------------------------------------------------------------
    /**
     * Starts a new debug adapter and sets up communication via stdin/stdout.
     * If a port number is specified the adapter is not launched but a connection to
     * a debug adapter running in server mode is established. This is useful for debugging
     * the adapter while running tests. For this reason all timeouts are disabled in server mode.
     */
    DebugClient.prototype.start = function (port) {
        var _this = this;
        return new Promise(function (resolve, reject) {
            if (typeof port === 'number') {
                _this._socket = net.createConnection(port, '127.0.0.1', function () {
                    _this.connect(_this._socket, _this._socket);
                    resolve();
                });
            }
            else {
                _this._adapterProcess = cp.spawn(_this._runtime, [_this._executable]);
                var sanitize_1 = function (s) { return s.toString().replace(/\r?\n$/mg, ''); };
                _this._adapterProcess.stderr.on('data', function (data) {
                    if (_this._enableStderr) {
                        console.log(sanitize_1(data));
                    }
                });
                _this._adapterProcess.on('error', function (err) {
                    console.log(err);
                    reject(err);
                });
                _this._adapterProcess.on('exit', function (code, signal) {
                    if (code) {
                    }
                });
                _this.connect(_this._adapterProcess.stdout, _this._adapterProcess.stdin);
                resolve();
            }
        });
    };
    /**
     * Shutdown the debuggee and the debug adapter (or disconnect if in server mode).
     */
    DebugClient.prototype.stop = function () {
        var _this = this;
        return this.disconnectRequest().then(function () {
            _this.stopAdapter();
        }).catch(function () {
            _this.stopAdapter();
        });
    };
    DebugClient.prototype.stopAdapter = function () {
        if (this._adapterProcess) {
            this._adapterProcess.kill();
            this._adapterProcess = null;
        }
        if (this._socket) {
            this._socket.end();
            this._socket = null;
        }
    };
    // ---- protocol requests -------------------------------------------------------------------------------------------------
    DebugClient.prototype.initializeRequest = function (args) {
        if (!args) {
            args = {
                adapterID: this._debugType,
                linesStartAt1: true,
                columnsStartAt1: true,
                pathFormat: 'path'
            };
        }
        return this.send('initialize', args);
    };
    DebugClient.prototype.configurationDoneRequest = function (args) {
        return this.send('configurationDone', args);
    };
    DebugClient.prototype.launchRequest = function (args) {
        return this.send('launch', args);
    };
    DebugClient.prototype.attachRequest = function (args) {
        return this.send('attach', args);
    };
    DebugClient.prototype.restartRequest = function (args) {
        return this.send('restart', args);
    };
    DebugClient.prototype.disconnectRequest = function (args) {
        return this.send('disconnect', args);
    };
    DebugClient.prototype.setBreakpointsRequest = function (args) {
        return this.send('setBreakpoints', args);
    };
    DebugClient.prototype.setFunctionBreakpointsRequest = function (args) {
        return this.send('setFunctionBreakpoints', args);
    };
    DebugClient.prototype.setExceptionBreakpointsRequest = function (args) {
        return this.send('setExceptionBreakpoints', args);
    };
    DebugClient.prototype.continueRequest = function (args) {
        return this.send('continue', args);
    };
    DebugClient.prototype.nextRequest = function (args) {
        return this.send('next', args);
    };
    DebugClient.prototype.stepInRequest = function (args) {
        return this.send('stepIn', args);
    };
    DebugClient.prototype.stepOutRequest = function (args) {
        return this.send('stepOut', args);
    };
    DebugClient.prototype.stepBackRequest = function (args) {
        return this.send('stepBack', args);
    };
    DebugClient.prototype.reverseContinueRequest = function (args) {
        return this.send('reverseContinue', args);
    };
    DebugClient.prototype.restartFrameRequest = function (args) {
        return this.send('restartFrame', args);
    };
    DebugClient.prototype.gotoRequest = function (args) {
        return this.send('goto', args);
    };
    DebugClient.prototype.pauseRequest = function (args) {
        return this.send('pause', args);
    };
    DebugClient.prototype.stackTraceRequest = function (args) {
        return this.send('stackTrace', args);
    };
    DebugClient.prototype.scopesRequest = function (args) {
        return this.send('scopes', args);
    };
    DebugClient.prototype.variablesRequest = function (args) {
        return this.send('variables', args);
    };
    DebugClient.prototype.setVariableRequest = function (args) {
        return this.send('setVariable', args);
    };
    DebugClient.prototype.sourceRequest = function (args) {
        return this.send('source', args);
    };
    DebugClient.prototype.threadsRequest = function () {
        return this.send('threads');
    };
    DebugClient.prototype.modulesRequest = function (args) {
        return this.send('modules');
    };
    DebugClient.prototype.evaluateRequest = function (args) {
        return this.send('evaluate', args);
    };
    DebugClient.prototype.stepInTargetsRequest = function (args) {
        return this.send('stepInTargets', args);
    };
    DebugClient.prototype.gotoTargetsRequest = function (args) {
        return this.send('gotoTargets', args);
    };
    DebugClient.prototype.completionsRequest = function (args) {
        return this.send('completions', args);
    };
    DebugClient.prototype.exceptionInfoRequest = function (args) {
        return this.send('exceptionInfo', args);
    };
    DebugClient.prototype.customRequest = function (command, args) {
        return this.send(command, args);
    };
    // ---- convenience methods -----------------------------------------------------------------------------------------------
    /*
     * Returns a promise that will resolve if an event with a specific type was received within some specified time.
     * The promise will be rejected if a timeout occurs.
     */
    DebugClient.prototype.waitForEvent = function (eventType, timeout) {
        var _this = this;
        timeout = timeout || this.defaultTimeout;
        return new Promise(function (resolve, reject) {
            _this.once(eventType, function (event) {
                resolve(event);
            });
            if (!_this._socket) {
                setTimeout(function () {
                    reject(new Error("no event '" + eventType + "' received after " + timeout + " ms"));
                }, timeout);
            }
        });
    };
    /*
     * Returns a promise that will resolve if an 'initialized' event was received within some specified time
     * and a subsequent 'configurationDone' request was successfully executed.
     * The promise will be rejected if a timeout occurs or if the 'configurationDone' request fails.
     */
    DebugClient.prototype.configurationSequence = function () {
        var _this = this;
        return this.waitForEvent('initialized').then(function (event) {
            return _this.configurationDone();
        });
    };
    /**
     * Returns a promise that will resolve if a 'initialize' and a 'launch' request were successful.
     */
    DebugClient.prototype.launch = function (launchArgs) {
        var _this = this;
        return this.initializeRequest().then(function (response) {
            if (response.body && response.body.supportsConfigurationDoneRequest) {
                _this._supportsConfigurationDoneRequest = true;
            }
            return _this.launchRequest(launchArgs);
        });
    };
    DebugClient.prototype.configurationDone = function () {
        if (this._supportsConfigurationDoneRequest) {
            return this.configurationDoneRequest();
        }
        else {
            // if debug adapter doesn't support the configurationDoneRequest we have to send the setExceptionBreakpointsRequest.
            return this.setExceptionBreakpointsRequest({ filters: ['all'] });
        }
    };
    /*
     * Returns a promise that will resolve if a 'stopped' event was received within some specified time
     * and the event's reason and line number was asserted.
     * The promise will be rejected if a timeout occurs, the assertions fail, or if the 'stackTrace' request fails.
     */
    DebugClient.prototype.assertStoppedLocation = function (reason, expected) {
        var _this = this;
        return this.waitForEvent('stopped').then(function (event) {
            assert.equal(event.body.reason, reason);
            return _this.stackTraceRequest({
                threadId: event.body.threadId
            });
        }).then(function (response) {
            var frame = response.body.stackFrames[0];
            if (typeof expected.path === 'string' || expected.path instanceof RegExp) {
                _this.assertPath(frame.source.path, expected.path, 'stopped location: path mismatch');
            }
            if (typeof expected.line === 'number') {
                assert.equal(frame.line, expected.line, 'stopped location: line mismatch');
            }
            if (typeof expected.column === 'number') {
                assert.equal(frame.column, expected.column, 'stopped location: column mismatch');
            }
            return response;
        });
    };
    DebugClient.prototype.assertPartialLocationsEqual = function (locA, locB) {
        if (locA.path) {
            this.assertPath(locA.path, locB.path, 'breakpoint verification mismatch: path');
        }
        if (typeof locA.line === 'number') {
            assert.equal(locA.line, locB.line, 'breakpoint verification mismatch: line');
        }
        if (typeof locB.column === 'number' && typeof locA.column === 'number') {
            assert.equal(locA.column, locB.column, 'breakpoint verification mismatch: column');
        }
    };
    /*
     * Returns a promise that will resolve if enough output events with the given category have been received
     * and the concatenated data match the expected data.
     * The promise will be rejected as soon as the received data cannot match the expected data or if a timeout occurs.
     */
    DebugClient.prototype.assertOutput = function (category, expected, timeout) {
        var _this = this;
        timeout = timeout || this.defaultTimeout;
        return new Promise(function (resolve, reject) {
            var output = '';
            _this.on('output', function (event) {
                var e = event;
                if (e.body.category === category) {
                    output += e.body.output;
                    if (output.indexOf(expected) === 0) {
                        resolve(event);
                    }
                    else if (expected.indexOf(output) !== 0) {
                        var sanitize = function (s) { return s.toString().replace(/\r/mg, '\\r').replace(/\n/mg, '\\n'); };
                        reject(new Error("received data '" + sanitize(output) + "' is not a prefix of the expected data '" + sanitize(expected) + "'"));
                    }
                }
            });
            if (!_this._socket) {
                setTimeout(function () {
                    reject(new Error("not enough output data received after " + timeout + " ms"));
                }, timeout);
            }
        });
    };
    DebugClient.prototype.assertPath = function (path, expected, message) {
        if (expected instanceof RegExp) {
            assert.ok(expected.test(path), message);
        }
        else {
            if (DebugClient.CASE_INSENSITIVE_FILESYSTEM) {
                if (typeof path === 'string') {
                    path = path.toLowerCase();
                }
                if (typeof expected === 'string') {
                    expected = expected.toLowerCase();
                }
            }
            assert.equal(path, expected, message);
        }
    };
    // ---- scenarios ---------------------------------------------------------------------------------------------------------
    /**
     * Returns a promise that will resolve if a configurable breakpoint has been hit within some time
     * and the event's reason and line number was asserted.
     * The promise will be rejected if a timeout occurs, the assertions fail, or if the requests fails.
     */
    DebugClient.prototype.hitBreakpoint = function (launchArgs, location, expectedStopLocation, expectedBPLocation) {
        var _this = this;
        return Promise.all([
            this.waitForEvent('initialized').then(function (event) {
                return _this.setBreakpointsRequest({
                    lines: [location.line],
                    breakpoints: [{ line: location.line, column: location.column }],
                    source: { path: location.path }
                });
            }).then(function (response) {
                var bp = response.body.breakpoints[0];
                var verified = (typeof location.verified === 'boolean') ? location.verified : true;
                assert.equal(bp.verified, verified, 'breakpoint verification mismatch: verified');
                var actualLocation = {
                    column: bp.column,
                    line: bp.line,
                    path: bp.source && bp.source.path
                };
                _this.assertPartialLocationsEqual(actualLocation, expectedBPLocation || location);
                return _this.configurationDone();
            }),
            this.launch(launchArgs),
            this.assertStoppedLocation('breakpoint', expectedStopLocation || location)
        ]);
    };
    return DebugClient;
}(protocolClient_1.ProtocolClient));
exports.DebugClient = DebugClient;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGVidWdDbGllbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zcmMvZGVidWdDbGllbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7OztnR0FHZ0c7Ozs7Ozs7QUFFaEcsSUFBTyxFQUFFLFdBQVcsSUFBSSxDQUFDLENBQUM7QUFDMUIsSUFBTyxTQUFTLFdBQVcsV0FBVyxDQUFDLENBQUM7QUFDeEMsSUFBTyxFQUFFLFdBQVcsZUFBZSxDQUFDLENBQUM7QUFDckMsSUFBTyxNQUFNLFdBQVcsUUFBUSxDQUFDLENBQUM7QUFDbEMsSUFBTyxHQUFHLFdBQVcsS0FBSyxDQUFDLENBQUM7QUFFNUIsK0JBQTZCLGtCQUFrQixDQUFDLENBQUE7QUFnQmhEO0lBQWlDLCtCQUFjO0lBZTlDOzs7Ozs7Ozs7Ozs7Ozs7T0FlRztJQUNILHFCQUFZLE9BQWUsRUFBRSxVQUFrQixFQUFFLFNBQWlCO1FBQ2pFLGlCQUFPLENBQUM7UUFuQkYsbUJBQWMsR0FBRyxJQUFJLENBQUM7UUFvQjVCLElBQUksQ0FBQyxRQUFRLEdBQUcsT0FBTyxDQUFDO1FBQ3hCLElBQUksQ0FBQyxXQUFXLEdBQUcsVUFBVSxDQUFDO1FBQzlCLElBQUksQ0FBQyxhQUFhLEdBQUcsS0FBSyxDQUFDO1FBQzNCLElBQUksQ0FBQyxVQUFVLEdBQUcsU0FBUyxDQUFDO1FBQzVCLElBQUksQ0FBQyxpQ0FBaUMsR0FBRyxLQUFLLENBQUM7UUFFL0MsRUFBRSxDQUFDLENBQUMsV0FBVyxDQUFDLDJCQUEyQixLQUFLLFNBQVMsQ0FBQyxDQUFDLENBQUM7WUFDM0QsSUFBSSxDQUFDO2dCQUNKLEVBQUUsQ0FBQyxVQUFVLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxXQUFXLEVBQUUsRUFBRSxTQUFTLENBQUMsSUFBSSxDQUFDLENBQUM7Z0JBQzlELEVBQUUsQ0FBQyxVQUFVLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxXQUFXLEVBQUUsRUFBRSxTQUFTLENBQUMsSUFBSSxDQUFDLENB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QyxZQUFZLEVBQUUsb0JBQW9CLElBQUksUUFBUSxDQUFDO1NBRTFFLENBQUMsQ0FBQztJQUNKLENBQUM7SUFDRixrQkFBQztBQUFELENBQUMsQUEvYUQsQ0FBaUMsK0JBQWMsR0ErYTlDO0FBL2FZLG1CQUFXLGNBK2F2QixDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiLyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAqICBDb3B5cmlnaHQgKGMpIE1pY3Jvc29mdCBDb3Jwb3JhdGlvbi4gQWxsIHJpZ2h0cyByZXNlcnZlZC5cbiAqICBMaWNlbnNlZCB1bmRlciB0aGUgTUlUIExpY2Vuc2UuIFNlZSBMaWNlbnNlLnR4dCBpbiB0aGUgcHJvamVjdCByb290IGZvciBsaWNlbnNlIGluZm9ybWF0aW9uLlxuICotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cbmltcG9ydCBmcyA9IHJlcXVpcmUoJ2ZzJyk7XG5pbXBvcnQgY29uc3RhbnRzID0gcmVxdWlyZSgnY29uc3RhbnRzJyk7XG5pbXBvcnQgY3AgPSByZXF1aXJlKCdjaGlsZF9wcm9jZXNzJyk7XG5pbXBvcnQgYXNzZXJ0ID0gcmVxdWlyZSgnYXNzZXJ0Jyk7XG5pbXBvcnQgbmV0ID0gcmVxdWlyZSgnbmV0Jyk7XG5pbXBvcnQge0RlYnVnUHJvdG9jb2x9IGZyb20gJ3ZzY29kZS1kZWJ1Z3Byb3RvY29sJztcbmltcG9ydCB7UHJvdG9jb2xDbGllbnR9IGZyb20gJy4vcHJvdG9jb2xDbGllbnQnO1xuXG5leHBvcnQgaW50ZXJmYWNlIElMb2NhdGlvbiB7XG5cdHBhdGg6IHN0cmluZztcblx0bGluZTogbnVtYmVyO1xuXHRjb2x1bW4/OiBudW1iZXI7XG5cdHZlcmlmaWVkPzogYm9vbGVhbjtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBJUGFydGlhbExvY2F0aW9uIHtcblx0cGF0aD86IHN0cmluZztcblx0bGluZT86IG51bWJlcjtcblx0Y29sdW1uPzogbnVtYmVyO1xuXHR2ZXJpZmllZD86IGJvb2xlYW47XG59XG5cbmV4cG9ydCBjbGFzcyBEZWJ1Z0NsaWVudCBleHRlbmRzIFByb3RvY29sQ2xpZW50IHtcblxuXHRwcml2YXRlIHN0YXRpYyBDQVNFX0lOU0VOU0lUSVZFX0ZJTEVTWVNURU0gOiBib29sZWFuO1xuXG5cdHByaXZhdGUgX3J1bnRpbWU6IHN0cmluZztcblx0cHJpdmF0ZSBfZXhlY3V0YWJsZTogc3RyaW5nO1xuXHRwcml2YXRlIF9hZGFwdGVyUHJvY2VzczogY3AuQ2hpbGRQcm9jZXNzO1xuXHRwcml2YXRlIF9lbmFibGVTdGRlcnI6IGJvb2xlYW47XG5cdHByaXZhdGUgX2RlYnVnVHlwZTogc3RyaW5nO1xuXHRwcml2YXRlIF9zb2NrZXQ6IG5ldC5Tb2NrZXQ7XG5cblx0cHJpdmF0ZSBfc3VwcG9ydHNDb25maWd1cmF0aW9uRG9uZVJlcXVlc3Q6IGJvb2xlYW47XG5cblx0cHVibGljIGRlZmF1bHRUaW1lb3V0ID0gNTAwMDtcblxuXHQvKipcblx0ICogQ3JlYXRlcyBhIERlYnVnQ2xpZW50IG9iamVjdCB0aGF0IHByb3ZpZGVzIGEgcHJvbWlzZS1iYXNlZCBBUEkgdG8gd3JpdGVcblx0ICogZGVidWcgYWRhcHRlciB0ZXN0cy5cblx0ICogQSBzaW1wbGUgbW9jaGEgZXhhbXBsZSBmb3Igc2V0dGluZyBhbmQgaGl0dGluZyBhIGJyZWFrcG9pbnQgaW4gbGluZSAxNSBvZiBhIHByb2dyYW0gJ3Rlc3QuanMnIGxvb2tzIGxpa2UgdGhpczpcblx0ICpcblx0ICogdmFyIGRjO1xuXHQgKiBzZXR1cCggKCkgPT4ge1xuXHQgKiAgICAgZGMgPSBuZXcgRGVidWdDbGllbnQoJ25vZGUnLCAnLi9vdXQvbm9kZS9ub2RlRGVidWcuanMnLCAnbm9kZScpO1xuXHQgKiAgICAgcmV0dXJuIGRjLnN0YXJ0KCk7XG5cdCAqIH0pO1xuXHQgKiB0ZWFyZG93biggKCkgPT4gZGMuc3RvcCgpICk7XG5cdCAqXG5cdCAqIHRlc3QoJ3Nob3VsZCBzdG9wIG9uIGEgYnJlYWtwb2ludCcsICgpID0+IHtcblx0ICogICAgIHJldHVybiBkYy5oaXRCcmVha3BvaW50KHsgcHJvZ3JhbTogJ3Rlc3QuanMnIH0sICd0ZXN0LmpzJywgMTUpO1xuXHQgKiB9KTtcblx0ICovXG5cdGNvbnN0cnVjdG9yKHJ1bnRpbWU6IHN0cmluZywgZXhlY3V0YWJsZTogc3RyaW5nLCBkZWJ1Z1R5cGU6IHN0cmluZykge1xuXHRcdHN1cGVyKCk7XG5cdFx0dGhpcy5fcnVudGltZSA9IHJ1bnRpbWU7XG5cdFx0dGhpcy5fZXhlY3V0YWJsZSA9IGV4ZWN1dGFibGU7XG5cdFx0dGhpcy5fZW5hYmxlU3RkZXJyID0gZmFsc2U7XG5cdFx0dGhpcy5fZGVidWdUeXBlID0gZGVidWdUeXBlO1xuXHRcdHRoaXMuX3N1cHBvcnRzQ29uZmlndXJhdGlvbkRvbmVSZXF1ZXN0ID0gZmFsc2U7XG5cblx0XHRpZiAoRGVidWdDbGllbnQuQ0FTRV9JTlNFTlNJVElWRV9GSUxFU1lTVEVNID09PSB1bmRlZmluZWQpIHtcblx0XHRcdHRyeSB7XG5cdFx0XHRcdGZzLmFjY2Vzc1N5bmMocHJvY2Vzcy5leGVjUGF0aC50b0xvd2VyQ2FzZSgpLCBjb25zdGFudHMuRl9PSyk7XG5cdFx0XHRcdGZzLmFjY2Vzc1N5bmMocHJvY2Vzcy5leGVjUGF0aC50b1VwcGVyQ2FzZSgpLCBjb25zdGFudHMuRl9PSyk7XG5cdFx0XHRcdERlYnVnQ2xpZW50LkNBU0VfSU5TRU5TSVRJVkVfRklMRVNZU1RFTSA9IHRydWU7XG5cdFx0XHR9IGNhdGNoIChlcnIpIHtcblx0XHRcdFx0RGVidWdDbGllbnQuQ0FTRV9JTlNFTlNJVElWRV9GSUxFU1lTVEVNID0gZmFsc2U7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0Ly8gLS0tLSBsaWZlIGN5Y2xlIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cblx0LyoqXG5cdCAqIFN0YXJ0cyBhIG5ldyBkZWJ1ZyBhZGFwdGVyIGFuZCBzZXRzIHVwIGNvbW11bmljYXRpb24gdmlhIHN0ZGluL3N0ZG91dC5cblx0ICogSWYgYSBwb3J0IG51bWJlciBpcyBzcGVjaWZpZWQgdGhlIGFkYXB0ZXIgaXMgbm90IGxhdW5jaGVkIGJ1dCBhIGNvbm5lY3Rpb24gdG9cblx0ICogYSBkZWJ1ZyBhZGFwdGVyIHJ1bm5pbmcgaW4gc2VydmVyIG1vZGUgaXMgZXN0YWJsaXNoZWQuIFRoaXMgaXMgdXNlZnVsIGZvciBkZWJ1Z2dpbmdcblx0ICogdGhlIGFkYXB0ZXIgd2hpbGUgcnVubmluZyB0ZXN0cy4gRm9yIHRoaXMgcmVhc29uIGFsbCB0aW1lb3V0cyBhcmUgZGlzYWJsZWQgaW4gc2VydmVyIG1vZGUuXG5cdCAqL1xuXHRwdWJsaWMgc3RhcnQocG9ydD86IG51bWJlcik6IFByb21pc2U8dm9pZD4ge1xuXG5cdFx0cmV0dXJuIG5ldyBQcm9taXNlPHZvaWQ+KChyZXNvbHZlLCByZWplY3QpID0+IHtcblx0XHRcdGlmICh0eXBlb2YgcG9ydCA9PT0gJ251bWJlcicpIHtcblx0XHRcdFx0dGhpcy5fc29ja2V0ID0gbmV0LmNyZWF0ZUNvbm5lY3Rpb24ocG9ydCwgJzEyNy4wLjAuMScsICgpID0+IHtcblx0XHRcdFx0XHR0aGlzLmNvbm5lY3QodGhpcy5fc29ja2V0LCB0aGlzLl9zb2NrZXQpO1xuXHRcdFx0XHRcdHJlc29sdmUoKTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9hZGFwdGVyUHJvY2VzcyA9IGNwLnNwYXduKHRoaXMuX3J1bnRpbWUsIFsgdGhpcy5fZXhlY3V0YWJsZSBdKTtcblx0XHRcdFx0Y29uc3Qgc2FuaXRpemUgPSAoczogc3RyaW5nKSA9PiBzLnRvU3RyaW5nKCkucmVwbGFjZSgvXFxyP1xcbiQvbWcsICcnKTtcblx0XHRcdFx0dGhpcy5fYWRhcHRlclByb2Nlc3Muc3RkZXJyLm9uKCdkYXRhJywgKGRhdGE6IHN0cmluZykgPT4ge1xuXHRcdFx0XHRcdGlmICh0aGlzLl9lbmFibGVTdGRlcnIpIHtcblx0XHRcdFx0XHRcdGNvbnNvbGUubG9nKHNhbml0aXplKGRhdGEpKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0pO1xuXG5cdFx0XHRcdHRoaXMuX2FkYXB0ZXJQcm9jZXNzLm9uKCdlcnJvcicsIChlcnIpID0+IHtcblx0XHRcdFx0XHRjb25zb2xlLmxvZyhlcnIpO1xuXHRcdFx0XHRcdHJlamVjdChlcnIpO1xuXHRcdFx0XHR9KTtcblx0XHRcdFx0dGhpcy5fYWRhcHRlclByb2Nlc3Mub24oJ2V4aXQnLCAoY29kZTogbnVtYmVyLCBzaWduYWw6IHN0cmluZykgPT4ge1xuXHRcdFx0XHRcdGlmIChjb2RlKSB7XG5cdFx0XHRcdFx0XHQvLyBkb25lKG5ldyBFcnJvcignZGVidWcgYWRhcHRlciBleGl0IGNvZGU6ICcgKyBjb2RlKSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9KTtcblxuXHRcdFx0XHR0aGlzLmNvbm5lY3QodGhpcy5fYWRhcHRlclByb2Nlc3Muc3Rkb3V0LCB0aGlzLl9hZGFwdGVyUHJvY2Vzcy5zdGRpbik7XG5cdFx0XHRcdHJlc29sdmUoKTtcblx0XHRcdH1cblx0XHR9KTtcblx0fVxuXG5cdC8qKlxuXHQgKiBTaHV0ZG93biB0aGUgZGVidWdnZWUgYW5kIHRoZSBkZWJ1ZyBhZGFwdGVyIChvciBkaXNjb25uZWN0IGlmIGluIHNlcnZlciBtb2RlKS5cblx0ICovXG5cdHB1YmxpYyBzdG9wKCk6IFByb21pc2U8dm9pZD4ge1xuXG5cdFx0cmV0dXJuIHRoaXMuZGlzY29ubmVjdFJlcXVlc3QoKS50aGVuKCgpID0+IHtcblx0XHRcdHRoaXMuc3RvcEFkYXB0ZXIoKTtcblx0XHR9KS5jYXRjaCgoKSA9PiB7XG5cdFx0XHR0aGlzLnN0b3BBZGFwdGVyKCk7XG5cdFx0fSk7XG5cdH1cblxuXHRwcml2YXRlIHN0b3BBZGFwdGVyKCkge1xuXHRcdGlmICh0aGlzLl9hZGFwdGVyUHJvY2Vzcykge1xuXHRcdFx0dGhpcy5fYWRhcHRlclByb2Nlc3Mua2lsbCgpO1xuXHRcdFx0dGhpcy5fYWRhcHRlclByb2Nlc3MgPSBudWxsO1xuXHRcdH1cblx0XHRpZiAodGhpcy5fc29ja2V0KSB7XG5cdFx0XHR0aGlzLl9zb2NrZXQuZW5kKCk7XG5cdFx0XHR0aGlzLl9zb2NrZXQgPSBudWxsO1xuXHRcdH1cblx0fVxuXG5cdC8vIC0tLS0gcHJvdG9jb2wgcmVxdWVzdHMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG5cdHB1YmxpYyBpbml0aWFsaXplUmVxdWVzdChhcmdzPzogRGVidWdQcm90b2NvbC5Jbml0aWFsaXplUmVxdWVzdEFyZ3VtZW50cyk6IFByb21pc2U8RGVidWdQcm90b2NvbC5Jbml0aWFsaXplUmVzcG9uc2U+IHtcblx0XHRpZiAoIWFyZ3MpIHtcblx0XHRcdGFyZ3MgPSB7XG5cdFx0XHRcdGFkYXB0ZXJJRDogdGhpcy5fZGVidWdUeXBlLFxuXHRcdFx0XHRsaW5lc1N0YXJ0QXQxOiB0cnVlLFxuXHRcdFx0XHRjb2x1bW5zU3RhcnRBdDE6IHRydWUsXG5cdFx0XHRcdHBhdGhGb3JtYXQ6ICdwYXRoJ1xuXHRcdFx0fTtcblx0XHR9XG5cdFx0cmV0dXJuIHRoaXMuc2VuZCgnaW5pdGlhbGl6ZScsIGFyZ3MpO1xuXHR9XG5cblx0cHVibGljIGNvbmZpZ3VyYXRpb25Eb25lUmVxdWVzdChhcmdzPzogRGVidWdQcm90b2NvbC5Db25maWd1cmF0aW9uRG9uZUFyZ3VtZW50cyk6IFByb21pc2U8RGVidWdQcm90b2NvbC5Db25maWd1cmF0aW9uRG9uZVJlc3BvbnNlPiB7XG5cdFx0cmV0dXJuIHRoaXMuc2VuZCgnY29uZmlndXJhdGlvbkRvbmUnLCBhcmdzKTtcblx0fVxuXG5cdHB1YmxpYyBsYXVuY2hSZXF1ZXN0KGFyZ3M6IERlYnVnUHJvdG9jb2wuTGF1bmNoUmVxdWVzdEFyZ3VtZW50cyk6IFByb21pc2U8RGVidWdQcm90b2NvbC5MYXVuY2hSZXNwb25zZT4ge1xuXHRcdHJldHVybiB0aGlzLnNlbmQoJ2xhdW5jaCcsIGFyZ3MpO1xuXHR9XG5cblx0cHVibGljIGF0dGFjaFJlcXVlc3QoYXJnczogRGVidWdQcm90b2NvbC5BdHRhY2hSZXF1ZXN0QXJndW1lbnRzKTogUHJvbWlzZTxEZWJ1Z1Byb3RvY29sLkF0dGFjaFJlc3BvbnNlPiB7XG5cdFx0cmV0dXJuIHRoaXMuc2VuZCgnYXR0YWNoJywgYXJncyk7XG5cdH1cblxuXHRwdWJsaWMgcmVzdGFydFJlcXVlc3QoYXJnczogRGVidWdQcm90b2NvbC5SZXN0YXJ0QXJndW1lbnRzKTogUHJvbWlzZTxEZWJ1Z1Byb3RvY29sLlJlc3RhcnRSZXNwb25zZT4ge1xuXHRcdHJldHVybiB0aGlzLnNlbmQoJ3Jlc3RhcnQnLCBhcmdzKTtcblx0fVxuXG5cdHB1YmxpYyBkaXNjb25uZWN0UmVxdWVzdChhcmdzPzogRGVidWdQcm90b2NvbC5EaXNjb25uZWN0QXJndW1lbnRzKTogUHJvbWlzZTxEZWJ1Z1Byb3RvY29sLkRpc2Nvbm5lY3RSZXNwb25zZT4ge1xuXHRcdHJldHVybiB0aGlzLnNlbmQoJ2Rpc2Nvbm5lY3QnLCBhcmdzKTtcblx0fVxuXG5cdHB1YmxpYyBzZXRCcmVha3BvaW50c1JlcXVlc3QoYXJnczogRGVidWdQcm90b2NvbC5TZXRCcmVha3BvaW50c0FyZ3VtZW50cyk6IFByb21pc2U8RGVidWdQcm90b2NvbC5TZXRCcmVha3BvaW50c1Jlc3BvbnNlPiB7XG5cdFx0cmV0dXJuIHRoaXMuc2VuZCgnc2V0QnJlYWtwb2ludHMnLCBhcmdzKTtcblx0fVxuXG5cdHB1YmxpYyBzZXRGdW5jdGlvbkJyZWFrcG9pbnRzUmVxdWVzdChhcmdzOiBEZWJ1Z1Byb3RvY29sLlNldEZ1bmN0aW9uQnJlYWtwb2ludHNBcmd1bWVudHMpOiBQcm9taXNlPERlYnVnUHJvdG9jb2wuU2V0RnVuY3Rpb25CcmVha3BvaW50c1Jlc3BvbnNlPiB7XG5cdFx0cmV0dXJuIHRoaXMuc2VuZCgnc2V0RnVuY3Rpb25CcmVha3BvaW50cycsIGFyZ3MpO1xuXHR9XG5cblx0cHVibGljIHNldEV4Y2VwdGlvbkJyZWFrcG9pbnRzUmVxdWVzdChhcmdzOiBEZWJ1Z1Byb3RvY29sLlNldEV4Y2VwdGlvbkJyZWFrcG9pbnRzQXJndW1lbnRzKTogUHJvbWlzZTxEZWJ1Z1Byb3RvY29sLlNldEV4Y2VwdGlvbkJyZWFrcG9pbnRzUmVzcG9uc2U+IHtcblx0XHRyZXR1cm4gdGhpcy5zZW5kKCdzZXRFeGNlcHRpb25CcmVha3BvaW50cycsIGFyZ3MpO1xuXHR9XG5cblx0cHVibGljIGNvbnRpbnVlUmVxdWVzdChhcmdzOiBEZWJ1Z1Byb3RvY29sLkNvbnRpbnVlQXJndW1lbnRzKTogUHJvbWlzZTxEZWJ1Z1Byb3RvY29sLkNvbnRpbnVlUmVzcG9uc2U+IHtcblx0XHRyZXR1cm4gdGhpcy5zZW5kKCdjb250aW51ZScsIGFyZ3MpO1xuXHR9XG5cblx0cHVibGljIG5leHRSZXF1ZXN0KGFyZ3M6IERlYnVnUHJvdG9jb2wuTmV4dEFyZ3VtZW50cyk6IFByb21pc2U8RGVidWdQcm90b2NvbC5OZXh0UmVzcG9uc2U+IHtcblx0XHRyZXR1cm4gdGhpcy5zZW5kKCduZXh0JywgYXJncyk7XG5cdH1cblxuXHRwdWJsaWMgc3RlcEluUmVxdWVzdChhcmdzOiBEZWJ1Z1Byb3RvY29sLlN0ZXBJbkFyZ3VtZW50cyk6IFByb21pc2U8RGVidWdQcm90b2NvbC5TdGVwSW5SZXNwb25zZT4ge1xuXHRcdHJldHVybiB0aGlzLnNlbmQoJ3N0ZXBJbicsIGFyZ3MpO1xuXHR9XG5cblx0cHVibGljIHN0ZXBPdXRSZXF1ZXN0KGFyZ3M6IERlYnVnUHJvdG9jb2wuU3RlcE91dEFyZ3VtZW50cyk6IFByb21pc2U8RGVidWdQcm90b2NvbC5TdGVwT3V0UmVzcG9uc2U+IHtcblx0XHRyZXR1cm4gdGhpcy5zZW5kKCdzdGVwT3V0JywgYXJncyk7XG5cdH1cblxuXHRwdWJsaWMgc3RlcEJhY2tSZXF1ZXN0KGFyZ3M6IERlYnVnUHJvdG9jb2wuU3RlcEJhY2tBcmd1bWVudHMpOiBQcm9taXNlPERlYnVnUHJvdG9jb2wuU3RlcEJhY2tSZXNwb25zZT4ge1xuXHRcdHJldHVybiB0aGlzLnNlbmQoJ3N0ZXBCYWNrJywgYXJncyk7XG5cdH1cblxuXHRwdWJsaWMgcmV2ZXJzZUNvbnRpbnVlUmVxdWVzdChhcmdzOiBEZWJ1Z1Byb3RvY29sLlJldmVyc2VDb250aW51ZUFyZ3VtZW50cyk6IFByb21pc2U8RGVidWdQcm90b2NvbC5SZXZlcnNlQ29udGludWVSZXNwb25zZT4ge1xuXHRcdHJldHVybiB0aGlzLnNlbmQoJ3JldmVyc2VDb250aW51ZScsIGFyZ3MpO1xuXHR9XG5cblx0cHVibGljIHJlc3RhcnRGcmFtZVJlcXVlc3QoYXJnczogRGVidWdQcm90b2NvbC5SZXN0YXJ0RnJhbWVBcmd1bWVudHMpOiBQcm9taXNlPERlYnVnUHJvdG9jb2wuUmVzdGFydEZyYW1lUmVzcG9uc2U+IHtcblx0XHRyZXR1cm4gdGhpcy5zZW5kKCdyZXN0YXJ0RnJhbWUnLCBhcmdzKTtcblx0fVxuXG5cdHB1YmxpYyBnb3RvUmVxdWVzdChhcmdzOiBEZWJ1Z1Byb3RvY29sLkdvdG9Bcmd1bWVudHMpOiBQcm9taXNlPERlYnVnUHJvdG9jb2wuR290b1Jlc3BvbnNlPiB7XG5cdFx0cmV0dXJuIHRoaXMuc2VuZCgnZ290bycsIGFyZ3MpO1xuXHR9XG5cblx0cHVibGljIHBhdXNlUmVxdWVzdChhcmdzOiBEZWJ1Z1Byb3RvY29sLlBhdXNlQXJndW1lbnRzKTogUHJvbWlzZTxEZWJ1Z1Byb3RvY29sLlBhdXNlUmVzcG9uc2U+IHtcblx0XHRyZXR1cm4gdGhpcy5zZW5kKCdwYXVzZScsIGFyZ3MpO1xuXHR9XG5cblx0cHVibGljIHN0YWNrVHJhY2VSZXF1ZXN0KGFyZ3M6IERlYnVnUHJvdG9jb2wuU3RhY2tUcmFjZUFyZ3VtZW50cyk6IFByb21pc2U8RGVidWdQcm90b2NvbC5TdGFja1RyYWNlUmVzcG9uc2U+IHtcblx0XHRyZXR1cm4gdGhpcy5zZW5kKCdzdGFja1RyYWNlJywgYXJncyk7XG5cdH1cblxuXHRwdWJsaWMgc2NvcGVzUmVxdWVzdChhcmdzOiBEZWJ1Z1Byb3RvY29sLlNjb3Blc0FyZ3VtZW50cyk6IFByb21pc2U8RGVidWdQcm90b2NvbC5TY29wZXNSZXNwb25zZT4ge1xuXHRcdHJldHVybiB0aGlzLnNlbmQoJ3Njb3BlcycsIGFyZ3MpO1xuXHR9XG5cblx0cHVibGljIHZhcmlhYmxlc1JlcXVlc3QoYXJnczogRGVidWdQcm90b2NvbC5WYXJpYWJsZXNBcmd1bWVudHMpOiBQcm9taXNlPERlYnVnUHJvdG9jb2wuVmFyaWFibGVzUmVzcG9uc2U+IHtcblx0XHRyZXR1cm4gdGhpcy5zZW5kKCd2YXJpYWJsZXMnLCBhcmdzKTtcblx0fVxuXG5cdHB1YmxpYyBzZXRWYXJpYWJsZVJlcXVlc3QoYXJnczogRGVidWdQcm90b2NvbC5TZXRWYXJpYWJsZUFyZ3VtZW50cyk6IFByb21pc2U8RGVidWdQcm90b2NvbC5TZXRWYXJpYWJsZVJlc3BvbnNlPiB7XG5cdFx0cmV0dXJuIHRoaXMuc2VuZCgnc2V0VmFyaWFibGUnLCBhcmdzKTtcblx0fVxuXG5cdHB1YmxpYyBzb3VyY2VSZXF1ZXN0KGFyZ3M6IERlYnVnUHJvdG9jb2wuU291cmNlQXJndW1lbnRzKTogUHJvbWlzZTxEZWJ1Z1Byb3RvY29sLlNvdXJjZVJlc3BvbnNlPiB7XG5cdFx0cmV0dXJuIHRoaXMuc2VuZCgnc291cmNlJywgYXJncyk7XG5cdH1cblxuXHRwdWJsaWMgdGhyZWFkc1JlcXVlc3QoKTogUHJvbWlzZTxEZWJ1Z1Byb3RvY29sLlRocmVhZHNSZXNwb25zZT4ge1xuXHRcdHJldHVybiB0aGlzLnNlbmQoJ3RocmVhZHMnKTtcblx0fVxuXG5cdHB1YmxpYyBtb2R1bGVzUmVxdWVzdChhcmdzOiBEZWJ1Z1Byb3RvY29sLk1vZHVsZXNBcmd1bWVudHMpOiBQcm9taXNlPERlYnVnUHJvdG9jb2wuTW9kdWxlc1Jlc3BvbnNlPiB7XG5cdFx0cmV0dXJuIHRoaXMuc2VuZCgnbW9kdWxlcycpO1xuXHR9XG5cblx0cHVibGljIGV2YWx1YXRlUmVxdWVzdChhcmdzOiBEZWJ1Z1Byb3RvY29sLkV2YWx1YXRlQXJndW1lbnRzKTogUHJvbWlzZTxEZWJ1Z1Byb3RvY29sLkV2YWx1YXRlUmVzcG9uc2U+IHtcblx0XHRyZXR1cm4gdGhpcy5zZW5kKCdldmFsdWF0ZScsIGFyZ3MpO1xuXHR9XG5cblx0cHVibGljIHN0ZXBJblRhcmdldHNSZXF1ZXN0KGFyZ3M6IERlYnVnUHJvdG9jb2wuU3RlcEluVGFyZ2V0c0FyZ3VtZW50cyk6IFByb21pc2U8RGVidWdQcm90b2NvbC5TdGVwSW5UYXJnZXRzUmVzcG9uc2U+IHtcblx0XHRyZXR1cm4gdGhpcy5zZW5kKCdzdGVwSW5UYXJnZXRzJywgYXJncyk7XG5cdH1cblxuXHRwdWJsaWMgZ290b1RhcmdldHNSZXF1ZXN0KGFyZ3M6IERlYnVnUHJvdG9jb2wuR290b1RhcmdldHNBcmd1bWVudHMpOiBQcm9taXNlPERlYnVnUHJvdG9jb2wuR290b1RhcmdldHNSZXNwb25zZT4ge1xuXHRcdHJldHVybiB0aGlzLnNlbmQoJ2dvdG9UYXJnZXRzJywgYXJncyk7XG5cdH1cblxuXHRwdWJsaWMgY29tcGxldGlvbnNSZXF1ZXN0KGFyZ3M6IERlYnVnUHJvdG9jb2wuQ29tcGxldGlvbnNBcmd1bWVudHMpOiBQcm9taXNlPERlYnVnUHJvdG9jb2wuQ29tcGxldGlvbnNSZXNwb25zZT4ge1xuXHRcdHJldHVybiB0aGlzLnNlbmQoJ2NvbXBsZXRpb25zJywgYXJncyk7XG5cdH1cblxuXHRwdWJsaWMgZXhjZXB0aW9uSW5mb1JlcXVlc3QoYXJnczogRGVidWdQcm90b2NvbC5FeGNlcHRpb25JbmZvQXJndW1lbnRzKTogUHJvbWlzZTxEZWJ1Z1Byb3RvY29sLkV4Y2VwdGlvbkluZm9SZXNwb25zZT4ge1xuXHRcdHJldHVybiB0aGlzLnNlbmQoJ2V4Y2VwdGlvbkluZm8nLCBhcmdzKTtcblx0fVxuXG5cdHB1YmxpYyBjdXN0b21SZXF1ZXN0KGNvbW1hbmQ6IHN0cmluZywgYXJncz86IGFueSk6IFByb21pc2U8RGVidWdQcm90b2NvbC5SZXNwb25zZT4ge1xuXHRcdHJldHVybiB0aGlzLnNlbmQoY29tbWFuZCwgYXJncyk7XG5cdH1cblxuXHQvLyAtLS0tIGNvbnZlbmllbmNlIG1ldGhvZHMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuXHQvKlxuXHQgKiBSZXR1cm5zIGEgcHJvbWlzZSB0aGF0IHdpbGwgcmVzb2x2ZSBpZiBhbiBldmVudCB3aXRoIGEgc3BlY2lmaWMgdHlwZSB3YXMgcmVjZWl2ZWQgd2l0aGluIHNvbWUgc3BlY2lmaWVkIHRpbWUuXG5cdCAqIFRoZSBwcm9taXNlIHdpbGwgYmUgcmVqZWN0ZWQgaWYgYSB0aW1lb3V0IG9jY3Vycy5cblx0ICovXG5cdHB1YmxpYyB3YWl0Rm9yRXZlbnQoZXZlbnRUeXBlOiBzdHJpbmcsIHRpbWVvdXQ/OiBudW1iZXIpOiBQcm9taXNlPERlYnVnUHJvdG9jb2wuRXZlbnQ+IHtcblxuXHRcdHRpbWVvdXQgPSB0aW1lb3V0IHx8IHRoaXMuZGVmYXVsdFRpbWVvdXQ7XG5cblx0XHRyZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuXHRcdFx0dGhpcy5vbmNlKGV2ZW50VHlwZSwgZXZlbnQgPT4ge1xuXHRcdFx0XHRyZXNvbHZlKGV2ZW50KTtcblx0XHRcdH0pO1xuXHRcdFx0aWYgKCF0aGlzLl9zb2NrZXQpIHtcdC8vIG5vIHRpbWVvdXRzIGlmIGRlYnVnZ2luZyB0aGUgdGVzdHNcblx0XHRcdFx0c2V0VGltZW91dCgoKSA9PiB7XG5cdFx0XHRcdFx0cmVqZWN0KG5ldyBFcnJvcihgbm8gZXZlbnQgJyR7ZXZlbnRUeXBlfScgcmVjZWl2ZWQgYWZ0ZXIgJHt0aW1lb3V0fSBtc2ApKTtcblx0XHRcdFx0fSwgdGltZW91dCk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdH1cblxuXHQvKlxuXHQgKiBSZXR1cm5zIGEgcHJvbWlzZSB0aGF0IHdpbGwgcmVzb2x2ZSBpZiBhbiAnaW5pdGlhbGl6ZWQnIGV2ZW50IHdhcyByZWNlaXZlZCB3aXRoaW4gc29tZSBzcGVjaWZpZWQgdGltZVxuXHQgKiBhbmQgYSBzdWJzZXF1ZW50ICdjb25maWd1cmF0aW9uRG9uZScgcmVxdWVzdCB3YXMgc3VjY2Vzc2Z1bGx5IGV4ZWN1dGVkLlxuXHQgKiBUaGUgcHJvbWlzZSB3aWxsIGJlIHJlamVjdGVkIGlmIGEgdGltZW91dCBvY2N1cnMgb3IgaWYgdGhlICdjb25maWd1cmF0aW9uRG9uZScgcmVxdWVzdCBmYWlscy5cblx0ICovXG5cdHB1YmxpYyBjb25maWd1cmF0aW9uU2VxdWVuY2UoKTogUHJvbWlzZTxhbnk+IHtcblxuXHRcdHJldHVybiB0aGlzLndhaXRGb3JFdmVudCgnaW5pdGlhbGl6ZWQnKS50aGVuKGV2ZW50ID0+IHtcblx0XHRcdHJldHVybiB0aGlzLmNvbmZpZ3VyYXRpb25Eb25lKCk7XG5cdFx0fSk7XG5cdH1cblxuXHQvKipcblx0ICogUmV0dXJucyBhIHByb21pc2UgdGhhdCB3aWxsIHJlc29sdmUgaWYgYSAnaW5pdGlhbGl6ZScgYW5kIGEgJ2xhdW5jaCcgcmVxdWVzdCB3ZXJlIHN1Y2Nlc3NmdWwuXG5cdCAqL1xuXHRwdWJsaWMgbGF1bmNoKGxhdW5jaEFyZ3M6IGFueSk6IFByb21pc2U8RGVidWdQcm90b2NvbC5MYXVuY2hSZXNwb25zZT4ge1xuXG5cdFx0cmV0dXJuIHRoaXMuaW5pdGlhbGl6ZVJlcXVlc3QoKS50aGVuKHJlc3BvbnNlID0+IHtcblx0XHRcdGlmIChyZXNwb25zZS5ib2R5ICYmIHJlc3BvbnNlLmJvZHkuc3VwcG9ydHNDb25maWd1cmF0aW9uRG9uZVJlcXVlc3QpIHtcblx0XHRcdFx0dGhpcy5fc3VwcG9ydHNDb25maWd1cmF0aW9uRG9uZVJlcXVlc3QgPSB0cnVlO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHRoaXMubGF1bmNoUmVxdWVzdChsYXVuY2hBcmdzKTtcblx0XHR9KTtcblx0fVxuXG5cdHByaXZhdGUgY29uZmlndXJhdGlvbkRvbmUoKSA6IFByb21pc2U8RGVidWdQcm90b2NvbC5SZXNwb25zZT4ge1xuXHRcdGlmICh0aGlzLl9zdXBwb3J0c0NvbmZpZ3VyYXRpb25Eb25lUmVxdWVzdCkge1xuXHRcdFx0cmV0dXJuIHRoaXMuY29uZmlndXJhdGlvbkRvbmVSZXF1ZXN0KCk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdC8vIGlmIGRlYnVnIGFkYXB0ZXIgZG9lc24ndCBzdXBwb3J0IHRoZSBjb25maWd1cmF0aW9uRG9uZVJlcXVlc3Qgd2UgaGF2ZSB0byBzZW5kIHRoZSBzZXRFeGNlcHRpb25CcmVha3BvaW50c1JlcXVlc3QuXG5cdFx0XHRyZXR1cm4gdGhpcy5zZXRFeGNlcHRpb25CcmVha3BvaW50c1JlcXVlc3QoeyBmaWx0ZXJzOiBbICdhbGwnIF0gfSk7XG5cdFx0fVxuXHR9XG5cblx0Lypcblx0ICogUmV0dXJucyBhIHByb21pc2UgdGhhdCB3aWxsIHJlc29sdmUgaWYgYSAnc3RvcHBlZCcgZXZlbnQgd2FzIHJlY2VpdmVkIHdpdGhpbiBzb21lIHNwZWNpZmllZCB0aW1lXG5cdCAqIGFuZCB0aGUgZXZlbnQncyByZWFzb24gYW5kIGxpbmUgbnVtYmVyIHdhcyBhc3NlcnRlZC5cblx0ICogVGhlIHByb21pc2Ugd2lsbCBiZSByZWplY3RlZCBpZiBhIHRpbWVvdXQgb2NjdXJzLCB0aGUgYXNzZXJ0aW9ucyBmYWlsLCBvciBpZiB0aGUgJ3N0YWNrVHJhY2UnIHJlcXVlc3QgZmFpbHMuXG5cdCAqL1xuXHRwdWJsaWMgYXNzZXJ0U3RvcHBlZExvY2F0aW9uKHJlYXNvbjogc3RyaW5nLCBleHBlY3RlZDogeyBwYXRoPzogc3RyaW5nIHwgUmVnRXhwLCBsaW5lPzogbnVtYmVyLCBjb2x1bW4/OiBudW1iZXIgfSApIDogUHJvbWlzZTxEZWJ1Z1Byb3RvY29sLlN0YWNrVHJhY2VSZXNwb25zZT4ge1xuXG5cdFx0cmV0dXJuIHRoaXMud2FpdEZvckV2ZW50KCdzdG9wcGVkJykudGhlbihldmVudCA9PiB7XG5cdFx0XHRhc3NlcnQuZXF1YWwoZXZlbnQuYm9keS5yZWFzb24sIHJlYXNvbik7XG5cdFx0XHRyZXR1cm4gdGhpcy5zdGFja1RyYWNlUmVxdWVzdCh7XG5cdFx0XHRcdHRocmVhZElkOiBldmVudC5ib2R5LnRocmVhZElkXG5cdFx0XHR9KTtcblx0XHR9KS50aGVuKHJlc3BvbnNlID0+IHtcblx0XHRcdGNvbnN0IGZyYW1lID0gcmVzcG9uc2UuYm9keS5zdGFja0ZyYW1lc1swXTtcblx0XHRcdGlmICh0eXBlb2YgZXhwZWN0ZWQucGF0aCA9PT0gJ3N0cmluZycgfHwgZXhwZWN0ZWQucGF0aCBpbnN0YW5jZW9mIFJlZ0V4cCkge1xuXHRcdFx0XHR0aGlzLmFzc2VydFBhdGgoZnJhbWUuc291cmNlLnBhdGgsIGV4cGVjdGVkLnBhdGgsICdzdG9wcGVkIGxvY2F0aW9uOiBwYXRoIG1pc21hdGNoJyk7XG5cdFx0XHR9XG5cdFx0XHRpZiAodHlwZW9mIGV4cGVjdGVkLmxpbmUgPT09ICdudW1iZXInKSB7XG5cdFx0XHRcdGFzc2VydC5lcXVhbChmcmFtZS5saW5lLCBleHBlY3RlZC5saW5lLCAnc3RvcHBlZCBsb2NhdGlvbjogbGluZSBtaXNtYXRjaCcpO1xuXHRcdFx0fVxuXHRcdFx0aWYgKHR5cGVvZiBleHBlY3RlZC5jb2x1bW4gPT09ICdudW1iZXInKSB7XG5cdFx0XHRcdGFzc2VydC5lcXVhbChmcmFtZS5jb2x1bW4sIGV4cGVjdGVkLmNvbHVtbiwgJ3N0b3BwZWQgbG9jYXRpb246IGNvbHVtbiBtaXNtYXRjaCcpO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHJlc3BvbnNlO1xuXHRcdH0pO1xuXHR9XG5cblx0cHJpdmF0ZSBhc3NlcnRQYXJ0aWFsTG9jYXRpb25zRXF1YWwobG9jQTogSVBhcnRpYWxMb2NhdGlvbiwgbG9jQjogSVBhcnRpYWxMb2NhdGlvbik6IHZvaWQge1xuXHRcdGlmIChsb2NBLnBhdGgpIHtcblx0XHRcdHRoaXMuYXNzZXJ0UGF0aChsb2NBLnBhdGgsIGxvY0IucGF0aCwgJ2JyZWFrcG9pbnQgdmVyaWZpY2F0aW9uIG1pc21hdGNoOiBwYXRoJyk7XG5cdFx0fVxuXHRcdGlmICh0eXBlb2YgbG9jQS5saW5lID09PSAnbnVtYmVyJykge1xuXHRcdFx0YXNzZXJ0LmVxdWFsKGxvY0EubGluZSwgbG9jQi5saW5lLCAnYnJlYWtwb2ludCB2ZXJpZmljYXRpb24gbWlzbWF0Y2g6IGxpbmUnKTtcblx0XHR9XG5cdFx0aWYgKHR5cGVvZiBsb2NCLmNvbHVtbiA9PT0gJ251bWJlcicgJiYgdHlwZW9mIGxvY0EuY29sdW1uID09PSAnbnVtYmVyJykge1xuXHRcdFx0YXNzZXJ0LmVxdWFsKGxvY0EuY29sdW1uLCBsb2NCLmNvbHVtbiwgJ2JyZWFrcG9pbnQgdmVyaWZpY2F0aW9uIG1pc21hdGNoOiBjb2x1bW4nKTtcblx0XHR9XG5cdH1cblxuXHQvKlxuXHQgKiBSZXR1cm5zIGEgcHJvbWlzZSB0aGF0IHdpbGwgcmVzb2x2ZSBpZiBlbm91Z2ggb3V0cHV0IGV2ZW50cyB3aXRoIHRoZSBnaXZlbiBjYXRlZ29yeSBoYXZlIGJlZW4gcmVjZWl2ZWRcblx0ICogYW5kIHRoZSBjb25jYXRlbmF0ZWQgZGF0YSBtYXRjaCB0aGUgZXhwZWN0ZWQgZGF0YS5cblx0ICogVGhlIHByb21pc2Ugd2lsbCBiZSByZWplY3RlZCBhcyBzb29uIGFzIHRoZSByZWNlaXZlZCBkYXRhIGNhbm5vdCBtYXRjaCB0aGUgZXhwZWN0ZWQgZGF0YSBvciBpZiBhIHRpbWVvdXQgb2NjdXJzLlxuXHQgKi9cblx0cHVibGljIGFzc2VydE91dHB1dChjYXRlZ29yeTogc3RyaW5nLCBleHBlY3RlZDogc3RyaW5nLCB0aW1lb3V0PzogbnVtYmVyKTogUHJvbWlzZTxEZWJ1Z1Byb3RvY29sLkV2ZW50PiB7XG5cblx0XHR0aW1lb3V0ID0gdGltZW91dCB8fCB0aGlzLmRlZmF1bHRUaW1lb3V0O1xuXG5cdFx0cmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcblx0XHRcdGxldCBvdXRwdXQgPSAnJztcblx0XHRcdHRoaXMub24oJ291dHB1dCcsIGV2ZW50ID0+IHtcblx0XHRcdFx0Y29uc3QgZSA9IDxEZWJ1Z1Byb3RvY29sLk91dHB1dEV2ZW50PiBldmVudDtcblx0XHRcdFx0aWYgKGUuYm9keS5jYXRlZ29yeSA9PT0gY2F0ZWdvcnkpIHtcblx0XHRcdFx0XHRvdXRwdXQgKz0gZS5ib2R5Lm91dHB1dDtcblx0XHRcdFx0XHRpZiAob3V0cHV0LmluZGV4T2YoZXhwZWN0ZWQpID09PSAwKSB7XG5cdFx0XHRcdFx0XHRyZXNvbHZlKGV2ZW50KTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKGV4cGVjdGVkLmluZGV4T2Yob3V0cHV0KSAhPT0gMCkge1xuXHRcdFx0XHRcdFx0Y29uc3Qgc2FuaXRpemUgPSAoczogc3RyaW5nKSA9PiBzLnRvU3RyaW5nKCkucmVwbGFjZSgvXFxyL21nLCAnXFxcXHInKS5yZXBsYWNlKC9cXG4vbWcsICdcXFxcbicpO1xuXHRcdFx0XHRcdFx0cmVqZWN0KG5ldyBFcnJvcihgcmVjZWl2ZWQgZGF0YSAnJHtzYW5pdGl6ZShvdXRwdXQpfScgaXMgbm90IGEgcHJlZml4IG9mIHRoZSBleHBlY3RlZCBkYXRhICcke3Nhbml0aXplKGV4cGVjdGVkKX0nYCkpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0XHRpZiAoIXRoaXMuX3NvY2tldCkge1x0Ly8gbm8gdGltZW91dHMgaWYgZGVidWdnaW5nIHRoZSB0ZXN0c1xuXHRcdFx0XHRzZXRUaW1lb3V0KCgpID0+IHtcblx0XHRcdFx0XHRyZWplY3QobmV3IEVycm9yKGBub3QgZW5vdWdoIG91dHB1dCBkYXRhIHJlY2VpdmVkIGFmdGVyICR7dGltZW91dH0gbXNgKSk7XG5cdFx0XHRcdH0sIHRpbWVvdXQpO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHR9XG5cblx0cHVibGljIGFzc2VydFBhdGgocGF0aDogc3RyaW5nLCBleHBlY3RlZDogc3RyaW5nIHwgUmVnRXhwLCBtZXNzYWdlPzogc3RyaW5nKSB7XG5cblx0XHRpZiAoZXhwZWN0ZWQgaW5zdGFuY2VvZiBSZWdFeHApIHtcblx0XHRcdGFzc2VydC5vaygoPFJlZ0V4cD5leHBlY3RlZCkudGVzdChwYXRoKSwgbWVzc2FnZSk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdGlmIChEZWJ1Z0NsaWVudC5DQVNFX0lOU0VOU0lUSVZFX0ZJTEVTWVNURU0pIHtcblx0XHRcdFx0aWYgKHR5cGVvZiBwYXRoID09PSAnc3RyaW5nJykge1xuXHRcdFx0XHRcdHBhdGggPSBwYXRoLnRvTG93ZXJDYXNlKCk7XG5cdFx0XHRcdH1cblx0XHRcdFx0aWYgKHR5cGVvZiBleHBlY3RlZCA9PT0gJ3N0cmluZycpIHtcblx0XHRcdFx0XHRleHBlY3RlZCA9ICg8c3RyaW5nPmV4cGVjdGVkKS50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0XHRhc3NlcnQuZXF1YWwocGF0aCwgZXhwZWN0ZWQsIG1lc3NhZ2UpO1xuXHRcdH1cblx0fVxuXG5cdC8vIC0tLS0gc2NlbmFyaW9zIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG5cdC8qKlxuXHQgKiBSZXR1cm5zIGEgcHJvbWlzZSB0aGF0IHdpbGwgcmVzb2x2ZSBpZiBhIGNvbmZpZ3VyYWJsZSBicmVha3BvaW50IGhhcyBiZWVuIGhpdCB3aXRoaW4gc29tZSB0aW1lXG5cdCAqIGFuZCB0aGUgZXZlbnQncyByZWFzb24gYW5kIGxpbmUgbnVtYmVyIHdhcyBhc3NlcnRlZC5cblx0ICogVGhlIHByb21pc2Ugd2lsbCBiZSByZWplY3RlZCBpZiBhIHRpbWVvdXQgb2NjdXJzLCB0aGUgYXNzZXJ0aW9ucyBmYWlsLCBvciBpZiB0aGUgcmVxdWVzdHMgZmFpbHMuXG5cdCAqL1xuXHRwdWJsaWMgaGl0QnJlYWtwb2ludChsYXVuY2hBcmdzOiBhbnksIGxvY2F0aW9uOiBJTG9jYXRpb24sIGV4cGVjdGVkU3RvcExvY2F0aW9uPzogSVBhcnRpYWxMb2NhdGlvbiwgZXhwZWN0ZWRCUExvY2F0aW9uPzogSVBhcnRpYWxMb2NhdGlvbikgOiBQcm9taXNlPGFueT4ge1xuXG5cdFx0cmV0dXJuIFByb21pc2UuYWxsKFtcblxuXHRcdFx0dGhpcy53YWl0Rm9yRXZlbnQoJ2luaXRpYWxpemVkJykudGhlbihldmVudCA9PiB7XG5cdFx0XHRcdHJldHVybiB0aGlzLnNldEJyZWFrcG9pbnRzUmVxdWVzdCh7XG5cdFx0XHRcdFx0bGluZXM6IFsgbG9jYXRpb24ubGluZSBdLFxuXHRcdFx0XHRcdGJyZWFrcG9pbnRzOiBbIHsgbGluZTogbG9jYXRpb24ubGluZSwgY29sdW1uOiBsb2NhdGlvbi5jb2x1bW4gfSBdLFxuXHRcdFx0XHRcdHNvdXJjZTogeyBwYXRoOiBsb2NhdGlvbi5wYXRoIH1cblx0XHRcdFx0fSk7XG5cdFx0XHR9KS50aGVuKHJlc3BvbnNlID0+IHtcblxuXHRcdFx0XHRjb25zdCBicCA9IHJlc3BvbnNlLmJvZHkuYnJlYWtwb2ludHNbMF07XG5cblx0XHRcdFx0Y29uc3QgdmVyaWZpZWQgPSAodHlwZW9mIGxvY2F0aW9uLnZlcmlmaWVkID09PSAnYm9vbGVhbicpID8gbG9jYXRpb24udmVyaWZpZWQgOiB0cnVlO1xuXHRcdFx0XHRhc3NlcnQuZXF1YWwoYnAudmVyaWZpZWQsIHZlcmlmaWVkLCAnYnJlYWtwb2ludCB2ZXJpZmljYXRpb24gbWlzbWF0Y2g6IHZlcmlmaWVkJyk7XG5cblx0XHRcdFx0Y29uc3QgYWN0dWFsTG9jYXRpb246IElMb2NhdGlvbiA9IHtcblx0XHRcdFx0XHRjb2x1bW46IGJwLmNvbHVtbixcblx0XHRcdFx0XHRsaW5lOiBicC5saW5lLFxuXHRcdFx0XHRcdHBhdGg6IGJwLnNvdXJjZSAmJiBicC5zb3VyY2UucGF0aFxuXHRcdFx0XHR9O1xuXHRcdFx0XHR0aGlzLmFzc2VydFBhcnRpYWxMb2NhdGlvbnNFcXVhbChhY3R1YWxMb2NhdGlvbiwgZXhwZWN0ZWRCUExvY2F0aW9uIHx8IGxvY2F0aW9uKTtcblxuXHRcdFx0XHRyZXR1cm4gdGhpcy5jb25maWd1cmF0aW9uRG9uZSgpO1xuXHRcdFx0fSksXG5cblx0XHRcdHRoaXMubGF1bmNoKGxhdW5jaEFyZ3MpLFxuXG5cdFx0XHR0aGlzLmFzc2VydFN0b3BwZWRMb2NhdGlvbignYnJlYWtwb2ludCcsIGV4cGVjdGVkU3RvcExvY2F0aW9uIHx8IGxvY2F0aW9uKVxuXG5cdFx0XSk7XG5cdH1cbn1cbiJdfQ==